---
import SectionTitle from '../SectionTitle.astro';
import TimerIcon from '../icons/Timer.astro';
import TrustIndicator from '../TrustIndicator.astro';
import DeliveryBenefits from '../DeliveryBenefits.astro';
import TestimoniesCard from '../TestimoniesCard.astro';

import '../../styles/paymentMethods/DeliveryTime.css';
---

<section
	class='py-12 md:py-16 lg:px-8 bg-neutral-light relative overflow-hidden delivery-time-section'>
	<!-- Background decorative elements -->
	<div class='delivery-dots-pattern absolute inset-0 opacity-10'></div>
	<div class='delivery-shape-1'></div>
	<div class='delivery-shape-2'></div>

	<div class='container mx-auto px-4 relative z-10'>
		<div
			class='max-w-4xl mx-auto text-center mb-8 md:mb-12 animate-on-scroll fade-up'>
			<SectionTitle>Entrega inmediata, sin esperas</SectionTitle>
			<p class='text-gray-600 mt-4 max-w-2xl mx-auto'>
				Recibe tus libros digitales al instante después de confirmar tu
				pago. No pierdas tiempo valioso en tu aprendizaje.
			</p>
		</div>

		<!-- Main content with delivery timeline -->
		<div class='grid md:grid-cols-2 gap-8 md:gap-12 items-center'>
			<!-- Left Column: Delivery Info -->
			<div
				class='bg-white rounded-xl p-6 md:p-8 shadow-lg animate-on-scroll fade-right'>
				<div class='flex items-center mb-6'>
					<div class='p-3 bg-primary/10 rounded-full mr-4'>
						<TimerIcon class='w-8 h-8 text-primary' />
					</div>
					<h3 class='text-2xl font-bold text-primary-dark'>
						Proceso de entrega
					</h3>
				</div>

				<div
					class='delivery-timeline relative pl-8 border-l-2 border-primary/30'>
					<!-- Timeline steps -->
					<div class='timeline-item pb-8'>
						<div class='timeline-marker'></div>
						<h4 class='font-bold text-lg mb-2'>
							Confirmación del pago
						</h4>
						<p class='text-gray-600'>
							Una vez recibido y confirmado tu pago, comienza el
							proceso de entrega inmediata.
						</p>
					</div>

					<div class='timeline-item pb-8'>
						<div class='timeline-marker'></div>
						<h4 class='font-bold text-lg mb-2'>
							Preparación del material
						</h4>
						<p class='text-gray-600'>
							Preparamos tu acceso personalizado a todo el
							material seleccionado.
						</p>
					</div>

					<div class='timeline-item'>
						<div class='timeline-marker'></div>
						<h4 class='font-bold text-lg mb-2'>Entrega digital</h4>
						<p class='text-gray-600'>
							Recibes enlaces de acceso a Google Drive/OneDrive
							con todos tus libros y materiales.
						</p>
					</div>
				</div>

				<!-- Trust indicator -->
				<div
					class='mt-8 flex justify-center md:justify-start items-center space-x-2 text-xs text-gray-500'>
					<TrustIndicator />
					Datos protegidos y entrega garantizada
				</div>
			</div>

			<!-- Right Column: Stats and Visuals -->
			<div class='animate-on-scroll fade-left'>
				<!-- Delivery stats cards -->
				<div class='grid grid-cols-2 gap-4 mb-6'>
					<div
						class='bg-white rounded-lg p-5 shadow-md text-center delivery-stat-card'>
						<div class='text-4xl font-bold text-primary mb-2'>
							15<span class='text-lg'>min</span>
						</div>
						<p class='text-sm text-gray-600'>
							Tiempo máximo de espera
						</p>
					</div>
					<div
						class='bg-white rounded-lg p-5 shadow-md text-center delivery-stat-card'>
						<div class='text-4xl font-bold text-primary mb-2'>
							24<span class='text-lg'>h</span>
						</div>
						<p class='text-sm text-gray-600'>Soporte disponible</p>
					</div>
					<div
						class='bg-white rounded-lg p-5 shadow-md text-center delivery-stat-card'>
						<div class='text-4xl font-bold text-primary mb-2'>
							100<span class='text-lg'>%</span>
						</div>
						<p class='text-sm text-gray-600'>Entrega garantizada</p>
					</div>
					<div
						class='bg-white rounded-lg p-5 shadow-md text-center delivery-stat-card'>
						<div class='text-4xl font-bold text-primary mb-2'>
							0<span class='text-lg'>S/.</span>
						</div>
						<p class='text-sm text-gray-600'>Costo de envío</p>
					</div>
				</div>

				<!-- Delivery status animation -->
				<div class='bg-white rounded-lg p-6 shadow-md'>
					<div class='flex items-center justify-between mb-4'>
						<h4 class='font-bold text-primary-dark'>
							Estado actual del servicio
						</h4>
						<span
							class='px-3 py-1 bg-accent/20 text-accent rounded-full text-sm font-medium'
							>Activo</span
						>
					</div>
					<div class='flex items-center space-x-3 mb-4'>
						<div class='delivery-pulse'></div>
						<div class='text-sm'>
							Entregas procesándose en tiempo real
						</div>
					</div>
					<div class='delivery-progress-container'>
						<div class='delivery-progress-bar'></div>
					</div>
					<div class='mt-4 text-sm text-center text-gray-500'>
						Tiempo promedio de entrega actual: <strong
							class='text-primary'>~5 minutos</strong
						>
					</div>
				</div>
			</div>
		</div>

		<!-- Testimonials about delivery speed -->
		<div class='mt-12 md:mt-16 max-w-3xl mx-auto animate-on-scroll fade-up'>
			<div
				class='bg-white rounded-xl p-6 md:p-8 shadow-md relative overflow-hidden'>
				<div
					class='quote-marks opacity-10 absolute top-2 left-4 text-6xl text-primary'>
					"
				</div>
				<div class='relative z-10'>
					<h3 class='text-xl font-bold text-center mb-6'>
						Lo que dicen nuestros clientes
					</h3>

					<div class='delivery-testimonial-slider'>
						<div class='delivery-testimonial active'>
							<TestimoniesCard
								quote='¡Impresionante! Pagué y en menos de 5 minutos ya estaba descargando todos mis libros. Proceso súper eficiente.'
								author='Carlos M.'
								position='Lima, Perú'
								avatarUrl='https://i.pravatar.cc/150?img=68'
								rating={5}
								compact={true}
							/>
						</div>
						<div class='delivery-testimonial'>
							<TestimoniesCard
								quote='La entrega inmediata fue clave para mí. Necesitaba los materiales para una reunión al día siguiente y todo llegó en minutos.'
								author='Laura T.'
								position='Bogotá, Colombia'
								avatarUrl='https://i.pravatar.cc/150?img=48'
								rating={5}
								compact={true}
							/>
						</div>
						<div class='delivery-testimonial'>
							<TestimoniesCard
								quote='El acceso instantáneo es realmente instantáneo. Envié mi comprobante por WhatsApp y en menos de 10 minutos ya tenía todo listo.'
								author='Juan D.'
								position='Madrid, España'
								avatarUrl='https://i.pravatar.cc/150?img=33'
								rating={4.5}
								compact={true}
							/>
						</div>
					</div>

					<!-- Testimonial navigation dots -->
					<div class='flex justify-center space-x-2 mt-6'>
						<button
							class='w-3 h-3 rounded-full bg-primary opacity-100 testimonial-dot active'
							aria-label='Testimonial 1'></button>
						<button
							class='w-3 h-3 rounded-full bg-primary opacity-40 testimonial-dot'
							aria-label='Testimonial 2'></button>
						<button
							class='w-3 h-3 rounded-full bg-primary opacity-40 testimonial-dot'
							aria-label='Testimonial 3'></button>
					</div>
				</div>
			</div>
		</div>

		<!-- Delivery Benefits -->
		<DeliveryBenefits />
	</div>
</section>

<script>
	// Animation on scroll
	document.addEventListener('DOMContentLoaded', () => {
		const observer = new IntersectionObserver(
			(entries) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						entry.target.classList.add('animated');
						observer.unobserve(entry.target);
					}
				});
			},
			{
				threshold: 0.1,
				rootMargin: '0px 0px -50px 0px',
			}
		);

		document.querySelectorAll('.animate-on-scroll').forEach((el) => {
			observer.observe(el);
		});

		// Testimonial slider functionality
		const testimonials = document.querySelectorAll('.delivery-testimonial');
		const dots = document.querySelectorAll('.testimonial-dot');

		dots.forEach((dot, index) => {
			dot.addEventListener('click', () => {
				// Remove active class from all testimonials and dots
				testimonials.forEach((t) => t.classList.remove('active'));
				dots.forEach((d) =>
					d.classList.remove('active', 'opacity-100')
				);
				dots.forEach((d) => d.classList.add('opacity-40'));

				// Add active class to current testimonial and dot
				testimonials[index].classList.add('active');
				dot.classList.add('active', 'opacity-100');
				dot.classList.remove('opacity-40');
			});
		});

		// Auto-rotate testimonials every 5 seconds
		let currentIndex = 0;
		const autoRotate = setInterval(() => {
			currentIndex = (currentIndex + 1) % testimonials.length;

			// Remove active class from all testimonials and dots
			testimonials.forEach((t) => t.classList.remove('active'));
			dots.forEach((d) => d.classList.remove('active', 'opacity-100'));
			dots.forEach((d) => d.classList.add('opacity-40'));

			// Add active class to current testimonial and dot
			testimonials[currentIndex].classList.add('active');
			dots[currentIndex].classList.add('active', 'opacity-100');
			dots[currentIndex].classList.remove('opacity-40');
		}, 5000);

		// Clear interval on mouse interaction
		document
			.querySelector('.delivery-testimonial-slider')
			?.addEventListener('mouseenter', () => {
				clearInterval(autoRotate);
			});
	});

	// Improved testimonial slider functionality
	document.addEventListener('DOMContentLoaded', () => {
		const testimonials = document.querySelectorAll('.delivery-testimonial');
		const dots = document.querySelectorAll('.testimonial-dot');

		if (!testimonials.length || !dots.length) return;

		// Initialize - make sure the first one is visible
		testimonials[0].classList.add('active');
		dots[0].classList.add('active', 'opacity-100');
		dots[0].classList.remove('opacity-40');

		dots.forEach((dot, index) => {
			dot.addEventListener('click', () => {
				// Remove active class from all testimonials and dots
				testimonials.forEach((t) => t.classList.remove('active'));
				dots.forEach((d) => {
					d.classList.remove('active', 'opacity-100');
					d.classList.add('opacity-40');
				});

				// Add active class to current testimonial and dot
				testimonials[index].classList.add('active');
				dot.classList.add('active', 'opacity-100');
				dot.classList.remove('opacity-40');
			});
		});

		// Auto-rotate testimonials every 5 seconds
		let currentIndex = 0;
		const autoRotate = setInterval(() => {
			currentIndex = (currentIndex + 1) % testimonials.length;

			// Remove active class from all testimonials and dots
			testimonials.forEach((t) => t.classList.remove('active'));
			dots.forEach((d) => {
				d.classList.remove('active', 'opacity-100');
				d.classList.add('opacity-40');
			});

			// Add active class to current testimonial and dot
			testimonials[currentIndex].classList.add('active');
			dots[currentIndex].classList.add('active', 'opacity-100');
			dots[currentIndex].classList.remove('opacity-40');
		}, 5000);

		// Pause auto-rotation on mouse interaction
		const slider = document.querySelector('.delivery-testimonial-slider');
		if (slider) {
			slider.addEventListener('mouseenter', () => {
				clearInterval(autoRotate);
			});
		}
	});
</script>
