---
import Layout from '../../../layouts/Layout.astro';
import SectionTitle from '../../../components/SectionTitle.astro';
import Breadcrumb from '../../../components/Breadcrumb.astro';
import CatalogPackContainer from '../../../components/catalog/CatalogPackContainer.astro';
import PromoSection from '../../../components/catalog/PromoSection.astro';
import FAQ from '../../../components/FAQ.astro';
import CTABanner from '../../../components/CTA-Banner.astro';
import CategoryCards from '../../../components/catalog/CategoryCards.astro';
import '../../../styles/catalog.css';

// Import data and types
import packsData from '../../../database/packs.json';
import type { Pack } from '../../../types/pack';
import {
	getFilteredPageTitle,
	getSafePacks,
	getBreadcrumbItems,
} from '../../../utils/packsUtils';

// Get filter parameters from URL if any
const { searchParams } = Astro.url;
const level = searchParams.get('level') || 'all';
const format = searchParams.get('format') || 'all';
const sort = searchParams.get('sort') || 'featured';

// Get page metadata based on filters
const { pageTitle, pageDescription, canonicalUrl, categoryHeroImage } =
	getFilteredPageTitle({
		level,
		format,
		baseUrl: '/catalogo/packs',
		site: Astro.site as URL,
	});

// Transform raw data to properly validated Pack objects
const safePacks: Pack[] = getSafePacks(packsData);

// Define breadcrumb navigation
const breadcrumbItems = getBreadcrumbItems();
---

<Layout
	title={`${pageTitle} | FluentReads`}
	description={pageDescription}
	canonicalURL={canonicalUrl}>
	<!-- Hero Banner -->
	<section
		class='catalog-hero py-12 bg-primary bg-cover bg-center text-white relative overflow-hidden'
		style={`background-image: linear-gradient(to bottom, rgba(30, 58, 138, 0.8), rgba(30, 58, 138, 0.5)), url(${categoryHeroImage});`}>
		<div
			class='absolute inset-0 bg-gradient-to-r from-primary-dark/80 to-primary/40'>
		</div>
		<div class='container mx-auto px-8 relative z-10'>
			<div class='grid grid-cols-1 md:grid-cols-3 gap-8 h-full'>
				<!-- Text content -->
				<div class='md:col-span-2 text-center md:text-left'>
					<!-- Breadcrumbs -->
					<Breadcrumb
						items={breadcrumbItems}
						class='mb-6 text-white/90'
					/>
					<div>
						<div
							class='inline-block mb-4 text-4xl p-4 bg-white/10 backdrop-blur-sm rounded-lg shadow-lg fade-in'>
							üìö
						</div>
						<h1
							class='text-3xl md:text-4xl lg:text-5xl font-bold mb-4 slide-in-left'>
							Packs de Libros en Ingl√©s
						</h1>
						<p
							class='text-lg md:text-xl text-white/90 max-w-2xl mb-6 slide-in-left delay-100'>
							Ahorra con nuestros paquetes especiales que incluyen
							libros, materiales digitales y recursos adicionales
							dise√±ados para maximizar tu aprendizaje del ingl√©s.
						</p>
						<div
							class='flex flex-wrap justify-center md:justify-start gap-4 slide-in-left delay-200'>
							<a
								href='#catalog-section'
								class='bg-secondary hover:bg-secondary-dark text-primary-dark font-bold py-3 px-6 rounded-lg transition-all duration-300 shadow-lg hover:shadow-xl'>
								Ver Packs
							</a>
							<a
								href='#contact-form'
								class='bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300'>
								Consultar Disponibilidad
							</a>
						</div>
					</div>
				</div>

				<!-- Decorative element -->
				<div
					class='hidden md:flex items-center justify-center relative overflow-hidden rounded-lg shadow-2xl border-4 border-white/20 fade-in delay-300'>
					<div
						class='aspect-[3/4] bg-gradient-to-br from-primary/40 to-accent/30 backdrop-blur-sm flex items-center justify-center w-full h-full'>
						<img
							src='/images/book-sample/book-sample-01.jpg'
							alt=''
							class='object-cover w-full h-full'
						/>
					</div>
				</div>
			</div>
		</div>

		<!-- Decorative shapes -->
		<div
			class='absolute -bottom-8 left-0 right-0 h-16 bg-white'
			style='clip-path: polygon(0 0, 100% 100%, 100% 100%, 0% 100%);'>
		</div>
		<div
			class='absolute -bottom-8 left-0 right-0 h-16 bg-white/20 backdrop-blur-sm'
			style='clip-path: polygon(0 0, 100% 100%, 100% 100%, 0% 100%);'>
		</div>
	</section>

	<!-- Main Catalog Section -->
	<section class='py-12 relative catalog-section' id='catalog-section'>
		<div class='absolute inset-0 catalog-pattern opacity-[0.03]'></div>
		<div class='container mx-auto px-4 relative z-10'>
			<!-- Main catalog - using our pack container component -->
			<CatalogPackContainer
				packs={safePacks}
				initialLevel={level}
				initialFormat={format}
				initialSort={sort}
				gridCols={3}
				productSize='medium'
			/>
		</div>
	</section>

	<!-- Related Categories Section -->
	<section class='py-12 bg-neutral-light'>
		<div class='container mx-auto px-4'>
			<div class='text-center mb-10'>
				<SectionTitle>Explora otras categor√≠as</SectionTitle>
				<p class='text-gray-600 max-w-3xl mx-auto'>
					Descubre nuestra selecci√≥n completa de materiales educativos
					en ingl√©s
				</p>
			</div>
			<CategoryCards />
		</div>
	</section>

	<!-- Promotional Section -->
	<PromoSection
		title='Ofertas y Promociones Exclusivas'
		subtitle='Ofertas Especiales'
		className='bg-gradient-to-br from-primary/5 to-accent/5 py-16'
		countdownDays={5}
		cardSize='large'
	/>

	<!-- FAQ Section -->
	<FAQ
		className='py-16'
		dataset='catalog'
		title='Preguntas frecuentes sobre nuestros packs'
		description='Resolvemos tus dudas sobre nuestros paquetes de materiales en ingl√©s.'
	/>

	<!-- CTA Banner -->
	<div class='container mx-auto px-4 mb-16'>
		<CTABanner type='default' />
	</div>
</Layout>

<style>
	.catalog-hero {
		background-position: center;
		background-size: cover;
		position: relative;
	}

	.catalog-pattern {
		background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.2'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
	}

	/* Animation Classes */
	.slide-in-left {
		animation: slideInLeft 0.8s ease forwards;
		opacity: 0;
		transform: translateX(-20px);
	}

	.delay-100 {
		animation-delay: 0.1s;
	}

	.delay-200 {
		animation-delay: 0.2s;
	}

	.delay-300 {
		animation-delay: 0.3s;
	}

	.fade-in {
		animation: fadeIn 1s ease forwards;
		opacity: 0;
	}

	@keyframes slideInLeft {
		from {
			opacity: 0;
			transform: translateX(-20px);
		}
		to {
			opacity: 1;
			transform: translateX(0);
		}
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
		}
		to {
			opacity: 1;
		}
	}
</style>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		// Smooth scroll to sections when clicking navigation links
		document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
			anchor.addEventListener(
				'click',
				function (this: HTMLAnchorElement, e) {
					e.preventDefault();
					const targetId = this.getAttribute('href');
					if (targetId) {
						const targetElement = document.querySelector(targetId);
						if (targetElement) {
							targetElement.scrollIntoView({
								behavior: 'smooth',
								block: 'start',
							});
						}
					}
				}
			);
		});
	});
</script>
